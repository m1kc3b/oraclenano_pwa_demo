(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function r(o){if(o.ep)return;o.ep=!0;const s=n(o);fetch(o.href,s)}})();let c;function y(e){const t=c.__externref_table_alloc();return c.__wbindgen_export_2.set(t,e),t}function w(e,t){try{return e.apply(this,t)}catch(n){const r=y(n);c.__wbindgen_exn_store(r)}}const O=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&O.decode();let p=null;function m(){return(p===null||p.byteLength===0)&&(p=new Uint8Array(c.memory.buffer)),p}function u(e,t){return e=e>>>0,O.decode(m().subarray(e,e+t))}function h(e){return e==null}function S(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const o=e.description;return o==null?"Symbol":`Symbol(${o})`}if(t=="function"){const o=e.name;return typeof o=="string"&&o.length>0?`Function(${o})`:"Function"}if(Array.isArray(e)){const o=e.length;let s="[";o>0&&(s+=S(e[0]));for(let i=1;i<o;i++)s+=", "+S(e[i]);return s+="]",s}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let r;if(n&&n.length>1)r=n[1];else return toString.call(e);if(r=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:r}let _=0;const E=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},j=typeof E.encodeInto=="function"?function(e,t){return E.encodeInto(e,t)}:function(e,t){const n=E.encode(e);return t.set(n),{read:e.length,written:n.length}};function d(e,t,n){if(n===void 0){const a=E.encode(e),b=t(a.length,1)>>>0;return m().subarray(b,b+a.length).set(a),_=a.length,b}let r=e.length,o=t(r,1)>>>0;const s=m();let i=0;for(;i<r;i++){const a=e.charCodeAt(i);if(a>127)break;s[o+i]=a}if(i!==r){i!==0&&(e=e.slice(i)),o=n(o,r,r=i+e.length*3,1)>>>0;const a=m().subarray(o+i,o+r),b=j(e,a);i+=b.written,o=n(o,r,i,1)>>>0}return _=i,o}let f=null;function I(){return(f===null||f.buffer.detached===!0||f.buffer.detached===void 0&&f.buffer!==c.memory.buffer)&&(f=new DataView(c.memory.buffer)),f}function l(e){const t=c.__wbindgen_export_2.get(e);return c.__externref_table_dealloc(e),t}function B(e){let t,n;try{const s=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),i=_,a=c.generate_encrypted_private_key(s,i);var r=a[0],o=a[1];if(a[3])throw r=0,o=0,l(a[2]);return t=r,n=o,u(r,o)}finally{c.__wbindgen_free(t,n,1)}}function W(e,t){const n=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),r=_,o=d(t,c.__wbindgen_malloc,c.__wbindgen_realloc),s=_,i=c.load_encrypted_private_key(n,r,o,s);if(i[1])throw l(i[0])}function k(){const e=c.get_public_key();let t;return e[0]!==0&&(t=u(e[0],e[1]).slice(),c.__wbindgen_free(e[0],e[1]*1,1)),t}function M(e,t){const n=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),r=_;c.add_entry(n,r,t)}function F(){const e=c.export_ledger();if(e[2])throw l(e[1]);return l(e[0])}function N(){return c.verify_chain()!==0}function P(e){const t=c.init_ledger(e);if(t[1])throw l(t[0])}function D(e){const t=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),n=_,r=c.get_signature_for_payload(t,n);let o;return r[0]!==0&&(o=u(r[0],r[1]).slice(),c.__wbindgen_free(r[0],r[1]*1,1)),o}function U(e,t){const n=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),r=_,o=d(t,c.__wbindgen_malloc,c.__wbindgen_realloc),s=_;return c.verify_payload_signature(n,r,o,s)!==0}function R(e){let t,n;try{const s=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),i=_,a=c.get_encrypted_ledger(s,i);var r=a[0],o=a[1];if(a[3])throw r=0,o=0,l(a[2]);return t=r,n=o,u(r,o)}finally{c.__wbindgen_free(t,n,1)}}function C(e,t){return e=e>>>0,m().subarray(e/1,e/1+t)}function $(e,t){const n=d(e,c.__wbindgen_malloc,c.__wbindgen_realloc),r=_,o=d(t,c.__wbindgen_malloc,c.__wbindgen_realloc),s=_,i=c.decrypt_private_key(n,r,o,s);if(i[3])throw l(i[2]);var a=C(i[0],i[1]).slice();return c.__wbindgen_free(i[0],i[1]*1,1),a}async function K(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(r){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function v(){const e={};return e.wbg={},e.wbg.__wbg_buffer_609cc3eee51ed158=function(t){return t.buffer},e.wbg.__wbg_call_672a4d21634d4a24=function(){return w(function(t,n){return t.call(n)},arguments)},e.wbg.__wbg_call_7cccdd69e0791ae2=function(){return w(function(t,n,r){return t.call(n,r)},arguments)},e.wbg.__wbg_crypto_574e78ad8b13b65f=function(t){return t.crypto},e.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return w(function(t,n){t.getRandomValues(n)},arguments)},e.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(t){return t.msCrypto},e.wbg.__wbg_new_405e22f390576ce2=function(){return new Object},e.wbg.__wbg_new_78feb108b6472713=function(){return new Array},e.wbg.__wbg_new_a12002a7f91c75be=function(t){return new Uint8Array(t)},e.wbg.__wbg_newnoargs_105ed471475aaf50=function(t,n){return new Function(u(t,n))},e.wbg.__wbg_newwithbyteoffsetandlength_d97e637ebe145a9a=function(t,n,r){return new Uint8Array(t,n>>>0,r>>>0)},e.wbg.__wbg_newwithlength_a381634e90c276d4=function(t){return new Uint8Array(t>>>0)},e.wbg.__wbg_node_905d3e251edff8a2=function(t){return t.node},e.wbg.__wbg_process_dc0fbacc7c1c06f7=function(t){return t.process},e.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return w(function(t,n){t.randomFillSync(n)},arguments)},e.wbg.__wbg_require_60cc747a6bc5215a=function(){return w(function(){return module.require},arguments)},e.wbg.__wbg_set_37837023f3d740e8=function(t,n,r){t[n>>>0]=r},e.wbg.__wbg_set_3f1d0b984ed272ed=function(t,n,r){t[n]=r},e.wbg.__wbg_set_65595bdd868b3009=function(t,n,r){t.set(n,r>>>0)},e.wbg.__wbg_static_accessor_GLOBAL_88a902d13a557d07=function(){const t=typeof global>"u"?null:global;return h(t)?0:y(t)},e.wbg.__wbg_static_accessor_GLOBAL_THIS_56578be7e9f832b0=function(){const t=typeof globalThis>"u"?null:globalThis;return h(t)?0:y(t)},e.wbg.__wbg_static_accessor_SELF_37c5d418e4bf5819=function(){const t=typeof self>"u"?null:self;return h(t)?0:y(t)},e.wbg.__wbg_static_accessor_WINDOW_5de37043a91a9c40=function(){const t=typeof window>"u"?null:window;return h(t)?0:y(t)},e.wbg.__wbg_subarray_aa9065fa9dc5df96=function(t,n,r){return t.subarray(n>>>0,r>>>0)},e.wbg.__wbg_versions_c01dfd4722a88165=function(t){return t.versions},e.wbg.__wbindgen_bigint_from_u64=function(t){return BigInt.asUintN(64,t)},e.wbg.__wbindgen_debug_string=function(t,n){const r=S(n),o=d(r,c.__wbindgen_malloc,c.__wbindgen_realloc),s=_;I().setInt32(t+4*1,s,!0),I().setInt32(t+4*0,o,!0)},e.wbg.__wbindgen_error_new=function(t,n){return new Error(u(t,n))},e.wbg.__wbindgen_init_externref_table=function(){const t=c.__wbindgen_export_2,n=t.grow(4);t.set(0,void 0),t.set(n+0,void 0),t.set(n+1,null),t.set(n+2,!0),t.set(n+3,!1)},e.wbg.__wbindgen_is_function=function(t){return typeof t=="function"},e.wbg.__wbindgen_is_object=function(t){const n=t;return typeof n=="object"&&n!==null},e.wbg.__wbindgen_is_string=function(t){return typeof t=="string"},e.wbg.__wbindgen_is_undefined=function(t){return t===void 0},e.wbg.__wbindgen_memory=function(){return c.memory},e.wbg.__wbindgen_number_new=function(t){return t},e.wbg.__wbindgen_string_new=function(t,n){return u(t,n)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(u(t,n))},e}function A(e,t){return c=e.exports,L.__wbindgen_wasm_module=t,f=null,p=null,c.__wbindgen_start(),c}function V(e){if(c!==void 0)return c;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module:e}=e:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const t=v();e instanceof WebAssembly.Module||(e=new WebAssembly.Module(e));const n=new WebAssembly.Instance(e,t);return A(n,e)}async function L(e){if(c!==void 0)return c;typeof e<"u"&&(Object.getPrototypeOf(e)===Object.prototype?{module_or_path:e}=e:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof e>"u"&&(e=new URL("/oraclenano_pwa_demo/assets/oraclenano_bg-BoFQZN_1.wasm",import.meta.url));const t=v();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:r}=await K(await e,t);return A(n,r)}const q=Object.freeze(Object.defineProperty({__proto__:null,add_entry:M,decrypt_private_key:$,default:L,export_ledger:F,generate_encrypted_private_key:B,get_encrypted_ledger:R,get_public_key:k,get_signature_for_payload:D,initSync:V,init_ledger:P,load_encrypted_private_key:W,verify_chain:N,verify_payload_signature:U},Symbol.toStringTag,{value:"Module"})),g={async init(e){await e.default(),this.wasm=e},async generateEncryptedKey(e){return this.wasm.generate_encrypted_private_key(e)},async loadEncryptedKey(e,t){return this.wasm.load_encrypted_private_key(e,t)},getPublicKey(){return this.wasm.get_public_key()},addEntry(e){const t=BigInt(Math.floor(Date.now()/1e3));return this.wasm.add_entry(e,t)},async getEncryptedLedger(e){return this.wasm.get_encrypted_ledger(e)},decryptEncryptedLedger(e,t){const n=this.wasm.decrypt_private_key(e,t);return new TextDecoder().decode(n)},initLedgerFromJson(e){return this.wasm.init_ledger(e)},verifyChain(){return this.wasm.verify_chain()},signPayload(e){return this.wasm.get_signature_for_payload(e)},verifyPayloadSignature(e,t){return this.wasm.verify_payload_signature(e,t)},async getLedger(){try{return await this.wasm.export_ledger()}catch(e){throw console.error("Erreur lors de l’export du ledger:",e),e}}};async function J(){await g.init(q)}document.getElementById("pw");const x=document.getElementById("msg");document.getElementById("output-json");const z=document.getElementById("output-crypted"),G=document.getElementById("output-decrypted");document.getElementById("decrypt");const H=document.getElementById("exampleModal"),T=document.getElementById("inputPassword2");H.addEventListener("shown.bs.modal",()=>{T.focus()});document.getElementById("add").onclick=async()=>{try{const e=T.value;if(localStorage.getItem("encrypted_key")==null){const r=await g.generateEncryptedKey(e);localStorage.setItem("encrypted_key",r)}else await g.generateEncryptedKey(e);const t=x.value;g.addEntry(t),x.value="";const n=await g.getEncryptedLedger(e);if(localStorage.setItem("encrypted_ledger",n),z.textContent=n,localStorage.getItem("encrypted_ledger")!=null){const r=localStorage.getItem("encrypted_ledger"),o=await g.decryptEncryptedLedger(r,e),s=JSON.parse(o);G.textContent=JSON.stringify(s,null,2)}}catch(e){console.error("Impossible d'ajouter un block: ",e)}};J();
